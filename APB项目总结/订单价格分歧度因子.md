### 因子：订单价格分歧程度因子
#### 定义：
```math
订单加权平均对数价格 = \frac{\sum \ln(订单价格) \cdot 订单委托量}{\sum 订单委托量}    
```
```math
订单绝对价格分歧程度 = \sqrt{\frac{\sum \left[ \ln(订单价格) - 订单加权平均对数价格 \right]^2 \cdot 订单委托量}{\sum 订单委托量}}
```

<details>
<summary>研报重点信息摘录</summary>    

1. 因子构建逻辑：
         
         在未区分买卖方向的情况下，该因子为区间内订单价格的委托量加权平均标准差

         订单价格 = 投资者对股票价值的判断 -> 订单价格的分歧程度 = 投资者对股票价值判断的分歧程度
         
         A股市场缺乏完善做空机制：价格分歧加剧 -> 多空双方博弈 -> 悲观观点无法充分表达 -> 短时间内价格被高估 -> 后期价格回落导致收益较差   

2. 研报结果：该因子呈现出显著的反向预测特性，分歧程度越小的股票平均表现更好，分歧程度越大的股票未来收益率越低
</details>

<details>
<summary>初步复现结果（未负向）</summary>
<img width="1125" height="791" alt="image" src="https://github.com/user-attachments/assets/ddb65383-d25f-43cf-9514-cc5f0603952b" />

</details>

<details>
<summary>可解释性分析</summary>    

1. 多头端（高分歧度）表现不佳
- 行为金融学 Miller原理        
   A股市场缺乏完善做空机制，存在做空限制。价格分歧加剧 -> 多空双方博弈 -> 悲观观点无法充分表达 -> 短时间内价格被高估 -> 后期价格回落后收益较差   
      
- 市场微观角度    
   高分歧可能说明了市场上信息不对称性,知情者与不知情者对该股价值判断存在系统性偏差    

2. 空头端（低分歧度）表现优异
- 行为金融学与信息效率    
   参与者对股票价值判断具有高度共识 -> 信息质量高 -> 被价格完全反映,价格有效性高 -> 收益率合理

</details>  

#### 初步改进：区分早盘与盘中
将订单委托时间分为早盘(<93000000)和盘中(93000000 <= order_time <145700000)两部分,分别构造因子    

<details>
<summary>主要结果</summary>
将订单委托时间分为早盘(<93000000)和盘中(93000000 <= order_time <145700000)两部分,分别构造因子    
<img width="1119" height="798" alt="image" src="https://github.com/user-attachments/assets/4db35b65-5636-4f4a-b06e-86ae22c04c21" />

<img width="1119" height="797" alt="image" src="https://github.com/user-attachments/assets/d3f77146-d169-4019-811d-70f59c9af2b8" />




</details>

#### 进一步改进：细化时间段划分并且区分买卖方向 （已负向）

- 说明：订单价格分歧度通过标准差计算，因子值全为正，反向后因子后值越大（越接近0），组别越高代表原始分歧度越小。

- 改进逻辑：

     -- 初步改进中两时间段分组收益率表现差异较大，说明不同时间段投资者交易风格不同。

     -- 区分买卖方向，探究买方与卖方的分歧度（交易风格）是否有本质性差异。

- 具体操作：把每天的数据按买卖方向和6个时间段划分为12个类型，分别测试，下面分买卖方进行讨论。     

- 6个时间段： 9:15-9:20  \ 9:20-9:25  \  9:30-10:00   \  10:00-14:30   \  14:30-14:57  \   14:57-15:00     

结果总结：**买方表现明显优于卖方。两方分组收益单调性一致，说明分歧度因子反应的收益与买卖意愿关系不大，而与波动率关系更大， 推翻了原研报中从A股的做空限制来解释因子的逻辑.** 

##### 卖方
<details>
<summary>主要结果</summary>

- 卖方效果较好的几个因子集中在尾盘附近，分别是 14:30-14:57  14：57-15：00
    
<img width="1123" height="794" alt="image" src="https://github.com/user-attachments/assets/7fa5c6d9-67cf-480b-81e2-c135cc97241e" />

<img width="1126" height="794" alt="image" src="https://github.com/user-attachments/assets/ca795e61-ab9b-4df6-b9a6-5e99b3639504" />


- 10:00-14:30的主交易时间段多头端表现比较好，但多空曲线波动较大    

<img width="1126" height="792" alt="image" src="https://github.com/user-attachments/assets/2477ee97-e4b2-4ad4-9a83-1ec473ffdcf6" />


- 早盘附近的表现会差很多
<img width="1124" height="796" alt="image" src="https://github.com/user-attachments/assets/4c6ad05d-b374-4296-ab6c-c5228acb964a" />
<img width="1125" height="796" alt="image" src="https://github.com/user-attachments/assets/784f41fd-d135-4d85-bd11-c61b332ad349" />

</details>


##### 买方
<details> 
<summary>早盘</summary>
早盘里细分的三个时间段，除了最开始可以撤单的时间多空曲线波动较大之外，其他两个看起来都不错。
<img width="1124" height="793" alt="image" src="https://github.com/user-attachments/assets/cbbd3b0d-af5a-4edb-bf88-4b9c3be03d43" />

<img width="1123" height="797" alt="image" src="https://github.com/user-attachments/assets/f201ae71-915c-43fa-a003-35640c8143df" />

<img width="1131" height="791" alt="image" src="https://github.com/user-attachments/assets/d4c16ef4-3841-4d3c-9668-f57ad75cd45b" />

</details>

<details> 
<summary>连续竞价</summary>
连续竞价期间表现得也很稳定
<img width="1120" height="795" alt="image" src="https://github.com/user-attachments/assets/899c08d7-05b2-4e6a-8cb3-3e13e8b5fd06" />

</details>

<details> 
<summary>尾盘</summary>
尾盘也看着还行，只有最后集合竞价的时候不太好
<img width="1128" height="793" alt="image" src="https://github.com/user-attachments/assets/6c9e65cf-1a9f-4365-9679-b0f6387beebd" />

<img width="1118" height="785" alt="image" src="https://github.com/user-attachments/assets/3c7662bb-7956-4852-811d-68164f8f9d3e" />

</details>


### 问题探究：为什么因子与rv的相关性在中性化（含标准化操作）前后出现跳水现象    

1. 确认出现原因：通过手动中性化操作，发现标准化过程中的winsorize过程影响了因子值中的极值点，进而导致了rv的突变

2. 探究极值来源：即使有价格笼子限制，委托单数据依然噪音巨大，存在大量不合理的订单价格。

<img width="1481" height="990" alt="image" src="https://github.com/user-attachments/assets/6fb276b1-da57-4203-9d41-e3a1b289ed5e" />


- 随机选择2023-11-01 这一天看异常价格订单委托量分布情况

<details>
<summary>统计信息</summary>

- 异常值规定: 5%以下或95%以上       

| 指标 | 值 |
|------|-----|
| 分析的股票总数 | 5073 |
| 异常价格订单委托量平均占比 | 14.10% |
| 异常价格订单委托量中位数占比 | 13.64% |
| 低价异常订单委托量平均占比 | 5.83% |
| 高价异常订单委托量平均占比 | 8.27% |
| 异常价格订单数量平均占比 | 8.47% |

- 异常价格订单委托量在总委托量中的占比：

| 阈值 | 超过阈值的股票比例 |
|------|------------------|
| > 1% | 99.98% |
| > 5% | 98.56% |
| > 10% | 89.61% | 
| > 20% | 6.76% |
| > 30% | 0.34% |
| > 50% | 0.02% |
</details>

3. 尝试了不同的改进方式
- 改进一：直接对订单价格进行**去尾**操作 [p01,p99]
<img width="1129" height="796" alt="image" src="https://github.com/user-attachments/assets/9f576934-3b6e-49f9-82b2-9ba685dd2544" />


- 改进二：以当日该股涨跌停价格作为界限，**替换**当日超出此范围的买单订单价格  
<img width="1122" height="796" alt="image" src="https://github.com/user-attachments/assets/2ddccf7e-13b9-4c8e-889d-f3504bd715eb" />



**结论：直接去除订单价格中的极端值效果更为显著，但会损失一定信息。接下来，尝试把去尾改为尝试不同力度的缩尾，并探究这一操作的合理性**






## 从2025-05-30的订单数据看缩尾的必要性

- 分析方法： 观察  ``订单价格各分位数/前日close_price`` 比值的统计量

<details>
<summary> 买单情况 ： 关注低位比值 </summary>
<img width="528" height="775" alt="image" src="https://github.com/user-attachments/assets/024d26e3-ec4b-41df-837b-15b5956dd8b5" />

</details>

<details>
<summary> 卖单情况 ： 关注高位比值 </summary>

##### 极低值比率统计 (min_ratio)

| 统计量 | ListedSector 1 | ListedSector 6 | ListedSector 7 |
|--------|----------------|----------------|----------------|
| 25%    | -0.036982      | -0.047380      | -0.030479      |
| 50%    | -0.023158      | -0.037538      | -0.020098      |
| 75%    | -0.011382      | -0.027869      | -0.010634      |
| count  | 3163.000000    | 1370.000000    | 586.000000     |
| max    | 0.099947       | 0.175928       | 0.088916       |
| mean   | -0.024676      | -0.037654      | -0.021043      |
| min    | **-0.162813**  | -0.171019      | -0.157050      |
| std    | 0.023060       | 0.024286       | 0.020429       |

##### 1%分位数比率统计 (p01_ratio)

| 统计量 | ListedSector 1 | ListedSector 6 | ListedSector 7 |
|--------|----------------|----------------|----------------|
| 25%    | -0.027314      | -0.034946      | -0.029341      |
| 50%    | -0.016965      | -0.025591      | -0.019145      |
| 75%    | -0.007465      | -0.015731      | -0.008633      |
| count  | 3163.000000    | 1370.000000    | 586.000000     |
| max    | 0.099947       | 0.177245       | 0.096782       |
| mean   | -0.017661      | -0.024835      | -0.019423      |
| min    | -0.145000      | -0.155204      | -0.151029      |
| std    | 0.021473       | 0.023989       | 0.020632       |

##### 5%分位数比率统计 (p5_ratio)

| 统计量 | ListedSector 1 | ListedSector 6 | ListedSector 7 |
|--------|----------------|----------------|----------------|
| 25%    | -0.024792      | -0.031637      | -0.028070      |
| 50%    | -0.013710      | -0.021490      | -0.017711      |
| 75%    | -0.005027      | -0.011558      | -0.006967      |
| count  | 3163.000000    | 1370.000000    | 586.000000     |
| max    | 0.100719       | 0.185383       | 0.104994       |
| mean   | -0.014996      | -0.021131      | -0.017608      |
| min    | -0.137813      | -0.152262      | -0.147015      |
| std    | 0.021626       | 0.024419       | 0.021069       |

##### 极高值比率统计 (max_ratio)

| 统计量 | ListedSector 1 | ListedSector 6 | ListedSector 7 |
|--------|----------------|----------------|----------------|
| 25%    | 0.099800       | 0.199901       | 0.199908       |
| 50%    | 0.100000       | 0.200000       | 0.200000       |
| 75%    | 0.100223       | 0.200122       | 0.200055       |
| count  | 3163.000000    | 1370.000000    | 586.000000     |
| max    | 6249.000000    | 0.201521       | 0.201166       |
| mean   | 2.073555       | 0.199841       | 0.197907       |
| min    | 0.047619       | 0.068845       | 0.020882       |
| std    | 111.110250     | 0.004095       | 0.015536       |

##### 99%分位数比率统计 (p99_ratio)

| 统计量 | ListedSector 1 | ListedSector 6 | ListedSector 7 |
|--------|----------------|----------------|----------------|
| 25%    | 0.022053       | 0.018544       | 0.002818       |
| 50%    | 0.051724       | 0.056918       | 0.022133       |
| 75%    | 0.097170       | 0.135048       | 0.068818       |
| count  | 3163.000000    | 1370.000000    | 586.000000     |
| max    | 0.818975       | 0.201521       | 0.200426       |
| mean   | 0.055792       | 0.078657       | 0.046802       |
| min    | -0.054859      | -0.080900      | -0.076720      |
| std    | 0.039045       | 0.070288       | 0.061973       |

##### 95%分位数比率统计 (p95_ratio)

| 统计量 | ListedSector 1 | ListedSector 6 | ListedSector 7 |
|--------|----------------|----------------|----------------|
| 25%    | -0.006344      | -0.013696      | -0.011762      |
| 50%    | 0.003089       | -0.003739      | -0.001222      |
| 75%    | 0.018008       | 0.012993       | 0.013640       |
| count  | 3163.000000    | 1370.000000    | 586.000000     |
| max    | 0.102326       | 0.200181       | 0.200000       |
| mean   | 0.009101       | 0.005915       | 0.004518       |
| min    | -0.072405      | -0.101841      | -0.081746      |
| std    | 0.026094       | 0.037090       | 0.032069       |

</details>

## 为买卖双方寻找合适的缩尾力度

- 研究不同程度的缩尾对因子值的影响
- 猜测：有大量买单堆积在跌停价，同时有大量卖单堆积在涨停价；故对买单关注左侧缩尾情况，对卖单关注右侧缩尾情况
- 目标：验证买卖双方是否有本质性差异，通过缩尾操作修正这部分由交易者投机心理导致的噪音，确认缩尾操作改进了因子表现
  
### 1. 极值分析：order_price/close_price时序图  

<details>
<summary> 未排除日新股时有大量极端值影响观测效果</summary>
<img width="1983" height="1178" alt="image" src="https://github.com/user-attachments/assets/4154a9f2-473d-490f-88d6-795ca9653be4" />


<img width="1983" height="1178" alt="image" src="https://github.com/user-attachments/assets/60cb7c12-8125-43cf-88a3-ab50061ac385" />


<details>
<summary> 以2025-05-30的日新股001390为例 </summary>

在尚未筛选订单时间段时，主板在极低值比率(min_ratio)的极小值为 `-0.999687`，说明有卖单价格接近0    
在限定时间为10：00-14：30之后，主板依然有-0.16极低比值存在  
后发现是001390股票，在2025-05-30新上市时导致的异常值   
<img width="297" height="149" alt="image" src="https://github.com/user-attachments/assets/cbf0b6eb-d819-4a9d-a347-c78da3c46be2" />

<img width="293" height="268" alt="image" src="https://github.com/user-attachments/assets/8fc597d7-647d-42d9-b074-a79c700c4596" />

<img width="308" height="258" alt="image" src="https://github.com/user-attachments/assets/368b7eb0-15f0-4f79-95c2-76d32425882a" />

<img width="283" height="257" alt="image" src="https://github.com/user-attachments/assets/9bf35241-aa09-433e-88a8-755f88ef9275" />


</details>  

</details>

<details>
<summary> 只保留[-0.2,0.2]的值：排除日新影响</summary>

##### 各分位数全市场均值    

<img width="1983" height="1178" alt="image" src="https://github.com/user-attachments/assets/bdd05f8a-a1c2-4fd6-8723-59de96155c28" />

<img width="1983" height="1178" alt="image" src="https://github.com/user-attachments/assets/d8710818-aac9-447f-b739-a7501e9c41de" />



##### 去尾处理后全市场ratio分位数时序图

<img width="1989" height="1573" alt="image" src="https://github.com/user-attachments/assets/daf22ffd-2953-4780-9b78-336d093bb74d" />

<img width="1989" height="1573" alt="image" src="https://github.com/user-attachments/assets/60bcd7e5-c5d0-48f4-9e53-d2fd401558dd" />


</details>


### 2. 针对bid_main_1000_1430
#####  Raw Factor (未做滚动平均）
<details>
<summary> 因子回测</summary>

<img width="1395" height="982" alt="image" src="https://github.com/user-attachments/assets/413dd339-74e8-4c23-bd7b-9f990f74c385" />

<img width="1397" height="991" alt="image" src="https://github.com/user-attachments/assets/0a44bcb1-6f3b-4e4f-b449-165e4cf6b3b5" />

<img width="1395" height="985" alt="image" src="https://github.com/user-attachments/assets/acf36fdf-b029-4aa3-9bef-85fec157cc94" />

</details>

<details>
<summary> 细分第一组，第十组差异</summary>

<img width="943" height="482" alt="image" src="https://github.com/user-attachments/assets/245e4b56-8cb0-4256-9b9b-049980cb249c" />

<img width="943" height="467" alt="image" src="https://github.com/user-attachments/assets/c7b1e55a-8db8-4105-abda-c44057915be5" />

</details>

<details>
<summary> 多空头转移情况</summary>

- 多头转移比例

<img width="232" height="172" alt="image" src="https://github.com/user-attachments/assets/fea78016-3e32-4dd2-8bc0-d4d7b656401d" />


<img width="150" height="180" alt="image" src="https://github.com/user-attachments/assets/eee987e6-e4bf-4d1d-a98c-3c450c77d1be" />

<img width="576" height="302" alt="image" src="https://github.com/user-attachments/assets/63d83d40-89a9-4a93-8b18-c03463f8142e" />


- 空头转移比例

<img width="187" height="177" alt="image" src="https://github.com/user-attachments/assets/e3b33cc9-4076-4066-a09b-fb8a08a739e3" />

<img width="145" height="181" alt="image" src="https://github.com/user-attachments/assets/0d2d3183-0363-4b97-9a26-0602583f0dd7" />

<img width="557" height="287" alt="image" src="https://github.com/user-attachments/assets/fb44a5a3-7156-47b1-a77b-8c721c18e94e" />


<details>
<summary> 对各组的转移贡献</summary>

<img width="940" height="462" alt="image" src="https://github.com/user-attachments/assets/1f089636-8599-4db1-ad6c-ee5387fa1e2e" />

<img width="937" height="462" alt="image" src="https://github.com/user-attachments/assets/37252420-b403-4809-8b0e-48a0521e52a8" />

<img width="951" height="466" alt="image" src="https://github.com/user-attachments/assets/cbe3d8f4-0023-41d7-aa29-4af7bf93eba6" />

</details>

</details>


#####  20D Factor
<details>
<summary> 因子回测</summary>

<img width="1388" height="986" alt="image" src="https://github.com/user-attachments/assets/d64695a6-738e-41aa-adc2-55cbabd83e9a" />

<img width="1391" height="982" alt="image" src="https://github.com/user-attachments/assets/abeeab65-f662-49bd-8952-c8ad18ad83d4" />

<img width="1396" height="991" alt="image" src="https://github.com/user-attachments/assets/da7d512e-0402-42a2-b41a-48a232f6666e" />

</details>


<details>
<summary> 细分第一组，第十组差异</summary>
<img width="932" height="447" alt="image" src="https://github.com/user-attachments/assets/6247f059-3d88-4416-b08f-f3da068ef340" />
<img width="925" height="456" alt="image" src="https://github.com/user-attachments/assets/55360f50-8032-4456-84ae-00c1e0726006" />

</details>

<details>
<summary> 多空头转移情况</summary>

- 多头转移比例

<img width="757" height="505" alt="image" src="https://github.com/user-attachments/assets/526b6ba6-dfb6-4334-94d0-0088d0d71fcd" />

<img width="588" height="296" alt="image" src="https://github.com/user-attachments/assets/83b9de60-7c75-43ce-a727-7c2e3f391e0b" />


- 空头转移比例

<img width="798" height="820" alt="image" src="https://github.com/user-attachments/assets/f79e48d2-075e-425b-8b58-180dabe7905d" />


</details>


<details>
<summary> 缩尾的必要性</summary>
<img width="528" height="775" alt="image" src="https://github.com/user-attachments/assets/a39ee79f-c765-4275-9a15-89e80fe5aa08" />

</details>

<details>
<summary> 极端值难以完全去除掉的原因</summary>

<img width="622" height="746" alt="image" src="https://github.com/user-attachments/assets/c54371e3-015b-4dec-8c64-8d03e9162ed4" />

<img width="505" height="501" alt="image" src="https://github.com/user-attachments/assets/bad70b0a-4ef5-4477-bed8-a33e173fba4b" />

</details>




### 3. 针对ask_main_1000_1430

#####  Raw Factor

<details>
<summary> 因子回测</summary>

<img width="1125" height="796" alt="image" src="https://github.com/user-attachments/assets/15181b9f-fbba-4d7a-96d2-69fe6adea3c5" />

<img width="1129" height="793" alt="image" src="https://github.com/user-attachments/assets/592c2d42-4919-4ca1-a493-55dad03fd580" />

<img width="1128" height="800" alt="image" src="https://github.com/user-attachments/assets/5ec5609e-3fd3-4808-b655-b275338cf6d9" />

</details>

<details>
<summary> 细看第一组第十组差异</summary>

<img width="1189" height="590" alt="image" src="https://github.com/user-attachments/assets/89fc0dc2-daeb-4240-bf22-4a210a8ef4df" />

<img width="1189" height="590" alt="image" src="https://github.com/user-attachments/assets/77cb50db-97ef-4a68-b089-e485c2d98659" />

</details>

<details>
<summary> 多空头转移情况</summary>
- 第一组转移比例
<img width="543" height="261" alt="image" src="https://github.com/user-attachments/assets/9e526dd1-e3b2-4938-a92e-1ccb2288feb2" />

<img width="357" height="425" alt="image" src="https://github.com/user-attachments/assets/a13f884d-28b9-4197-99f6-45befb0a9db0" />


- 第十组转移比例
<img width="512" height="213" alt="image" src="https://github.com/user-attachments/assets/1f2bebf7-4d35-4028-ba55-2b416065a935" />
<img width="372" height="457" alt="image" src="https://github.com/user-attachments/assets/d90b2d57-379a-4f5f-b810-cc01fa1eb426" />

<details>
<summary> 贡献率讨论</summary>

- 从第一组转移出去的
<img width="1021" height="736" alt="image" src="https://github.com/user-attachments/assets/c24258a3-acdf-4f6b-af60-8cd706aa09f0" />

<img width="1013" height="736" alt="image" src="https://github.com/user-attachments/assets/c844ea9f-fb74-44d3-b809-8eea4bc8d929" />


- 从第十组转移出去的
<img width="1013" height="736" alt="image" src="https://github.com/user-attachments/assets/0e5005b5-d870-422d-b47d-384c76120c6d" />

<img width="1013" height="736" alt="image" src="https://github.com/user-attachments/assets/e2006e61-8597-42cf-9677-00e0d45c0c2d" />

</details>

</details>

#####  20d Factor
<details>
<summary> 因子回测</summary>
<img width="1127" height="802" alt="image" src="https://github.com/user-attachments/assets/c0cad8c2-a92c-46ea-9cb7-43500ea7ab21" />

<img width="1127" height="798" alt="image" src="https://github.com/user-attachments/assets/90c63374-f36a-4221-b050-7ef0a63355db" />

<img width="1131" height="802" alt="image" src="https://github.com/user-attachments/assets/abdf7583-3352-4479-baec-52de19ffcb9c" />

</details>

<details>
<summary> 细看第一组第十组差异</summary>
<img width="1189" height="590" alt="image" src="https://github.com/user-attachments/assets/5dd09b58-ea56-47bb-a2a9-7b6399c8a8f1" />

<img width="1189" height="590" alt="image" src="https://github.com/user-attachments/assets/7ab71fef-0b6a-4a77-bc57-4f9fc9aeb145" />


</details>


<details>
<summary> 多空头转移情况</summary>

- 多头转移比例
<img width="472" height="249" alt="image" src="https://github.com/user-attachments/assets/634cafcd-654a-4a42-9a31-4507359271b0" />

<img width="365" height="428" alt="image" src="https://github.com/user-attachments/assets/72ae62a8-36cd-4f0c-863a-d5f28c9edad3" />


- 空头转移比例
<img width="497" height="232" alt="image" src="https://github.com/user-attachments/assets/64645cb4-ab9d-48c2-a7d5-bc0345b4ef18" />
<img width="363" height="456" alt="image" src="https://github.com/user-attachments/assets/d7d3ad75-fd65-4de6-b533-84d9e7101009" />


<details>
<summary> 贡献率讨论</summary>
<img width="1021" height="736" alt="image" src="https://github.com/user-attachments/assets/f5fa896c-4d2f-4a15-bac4-72ba87727c5a" />

<img width="1013" height="736" alt="image" src="https://github.com/user-attachments/assets/1b3bfbaa-3b5a-440d-9bda-3944caffb5d3" />

<img width="1013" height="736" alt="image" src="https://github.com/user-attachments/assets/0f66221e-6dcf-47a9-8585-709bf6b5d58c" />

<img width="1013" height="736" alt="image" src="https://github.com/user-attachments/assets/95a4de5f-b4cc-4e7f-9c30-705fdcc31ab4" />

</details>

</details>





### 不同程度缩尾方式效果比较

- 回测时间：2019-01-01 ~ 2025-05-31 
- Incap与行业中性，行业均值填充缺失值

#### 买方(BID)
<details> 
<summary> 0915 ~ 0920 </summary>
<img width="1124" height="793" alt="image" src="https://github.com/user-attachments/assets/0658cc74-f497-4e21-bb8c-0ac7c60f0f19" />
<img width="1134" height="795" alt="image" src="https://github.com/user-attachments/assets/bf29e9d8-0d54-496f-8dc8-fbc581e044d1" />
<img width="1124" height="792" alt="image" src="https://github.com/user-attachments/assets/d2321213-fecd-41db-a219-ce21f695154c" />
<img width="1125" height="801" alt="image" src="https://github.com/user-attachments/assets/46cc7d6c-23b7-4e53-815c-a109e16ca447" />


</details>
<details> 
<summary> 0920 ~ 0925 </summary>
<img width="1123" height="797" alt="image" src="https://github.com/user-attachments/assets/5140bfac-1682-43b7-b89e-992579b8d8c9" />
<img width="1129" height="795" alt="image" src="https://github.com/user-attachments/assets/3aa3dd99-76d5-4972-b5a4-4b390f84b8ff" />
<img width="1124" height="797" alt="image" src="https://github.com/user-attachments/assets/8bad7358-c2d7-4134-81f0-e1a6d090b884" />
<img width="1124" height="793" alt="image" src="https://github.com/user-attachments/assets/3be636ac-2df7-40cf-a1a0-053776de84f6" />

</details>
<details> 
<summary> 0930 ~ 1000 </summary>
<img width="1131" height="791" alt="image" src="https://github.com/user-attachments/assets/40efd6eb-f6e2-4784-b853-f1f2b5bf8893" />
<img width="1128" height="797" alt="image" src="https://github.com/user-attachments/assets/59cef69c-9818-466b-a993-247973b6b09b" />
<img width="1126" height="793" alt="image" src="https://github.com/user-attachments/assets/2f48efb6-8def-4b02-a990-aac79124ae00" />
<img width="1129" height="797" alt="image" src="https://github.com/user-attachments/assets/e29363b0-702b-4864-bc98-37c4aff9f240" />
<img width="673" height="657" alt="image" src="https://github.com/user-attachments/assets/91ae8e52-6b36-4d70-8016-3f217c6da59d" />

</details>
<details> 
<summary> 1000 ~ 1430 </summary>
<img width="1120" height="795" alt="image" src="https://github.com/user-attachments/assets/b97d7c44-d950-451f-a633-c5be47a95870" />
<img width="1125" height="792" alt="image" src="https://github.com/user-attachments/assets/ca59f425-1291-4f61-99b7-9d8d2b79230b" />
<img width="1124" height="791" alt="image" src="https://github.com/user-attachments/assets/559ad01d-21cb-4ae1-b814-e6ec271a0326" />
<img width="1126" height="799" alt="image" src="https://github.com/user-attachments/assets/bc1e2cb1-4d0e-4fa6-8f47-9fda0f8f8c0d" />
<img width="651" height="647" alt="image" src="https://github.com/user-attachments/assets/e55ec8d3-6152-46a2-be02-c836e7d758e0" />


</details>
<details> 
<summary> 1430 ~ 1457 </summary>
<img width="1128" height="793" alt="image" src="https://github.com/user-attachments/assets/8579e315-f15b-4f9e-86e3-cbd7b08b847f" />
<img width="1125" height="793" alt="image" src="https://github.com/user-attachments/assets/65b6c7ed-320e-4a0b-8a5e-31cc769f359f" />
<img width="1125" height="796" alt="image" src="https://github.com/user-attachments/assets/d131d833-cf19-4747-b0f6-09ba05df8bfe" />
<img width="1126" height="795" alt="image" src="https://github.com/user-attachments/assets/85271196-7ffc-458d-8d89-56d86fe9a831" />

</details>
<details> 
<summary> 1457 ~ 1500 </summary>
<img width="1118" height="785" alt="image" src="https://github.com/user-attachments/assets/b08a9855-34b7-4787-a9de-aed0a0279432" />
<img width="1126" height="792" alt="image" src="https://github.com/user-attachments/assets/f137b264-5c2a-40a6-95d7-9910e83569b0" />
<img width="1124" height="782" alt="image" src="https://github.com/user-attachments/assets/32925135-db3b-494f-90db-fafb20d8a421" />
<img width="1128" height="791" alt="image" src="https://github.com/user-attachments/assets/a11f5087-3a2d-48e3-9668-bbea63696be1" />

</details>
<details> 
<summary> 0930 ~ 1457 </summary>
<img width="1126" height="791" alt="image" src="https://github.com/user-attachments/assets/60bd3a84-1052-4565-928e-0d60c50fde82" />
<img width="1123" height="794" alt="image" src="https://github.com/user-attachments/assets/5fc95a19-42cf-45fd-b6a0-bce3f524f787" />
<img width="1123" height="791" alt="image" src="https://github.com/user-attachments/assets/9eb93684-baaa-45c6-8030-c86239694f95" />

</details>


#### 卖方(ASK)
<details> 
<summary> 0915 ~ 0920 </summary>
<img width="1122" height="793" alt="image" src="https://github.com/user-attachments/assets/37c99bb4-73af-42b1-97bf-0e5f9681fb9e" />
<img width="1122" height="789" alt="image" src="https://github.com/user-attachments/assets/9963a45e-7c93-401f-8fb2-eae320d073f3" />
<img width="1126" height="797" alt="image" src="https://github.com/user-attachments/assets/8f83bae8-cd14-4b06-85f0-084239340da2" />
<img width="1124" height="803" alt="image" src="https://github.com/user-attachments/assets/6e219c60-7fcc-4f84-984e-a07c18e74d59" />

</details>
<details> 
<summary> 0920 ~ 0925 </summary>
<img width="1125" height="796" alt="image" src="https://github.com/user-attachments/assets/2b5d2a2f-95db-46cb-a0ee-a60ec7ec6b50" />
<img width="1126" height="789" alt="image" src="https://github.com/user-attachments/assets/713ba422-6b3e-43fe-b1a6-6af01ffa1abe" />
<img width="1129" height="796" alt="image" src="https://github.com/user-attachments/assets/31b979a6-fd09-4191-bee5-a17d4cf66115" />
<img width="1124" height="794" alt="image" src="https://github.com/user-attachments/assets/043a50d9-62fd-406f-ae04-fb73fc662540" />

</details>
<details> 
<summary> 0930 ~ 1000 </summary>
<img width="1126" height="794" alt="image" src="https://github.com/user-attachments/assets/71105872-2438-43b1-b60e-312dcbd37ad1" />
<img width="1126" height="796" alt="image" src="https://github.com/user-attachments/assets/f1ff96f7-9435-43b3-ad50-08e3a25f658a" />
<img width="1123" height="799" alt="image" src="https://github.com/user-attachments/assets/ecbf023d-93f4-4425-87f4-3ff8499ec111" />
<img width="1124" height="789" alt="image" src="https://github.com/user-attachments/assets/9f95de81-60a1-4e33-a564-f8a008c925da" />

</details>
<details> 
<summary> 1000 ~ 1430 </summary>
<img width="1126" height="792" alt="image" src="https://github.com/user-attachments/assets/0db8ef0a-bd46-49cf-9f03-087c3df6008b" />
<img width="1124" height="792" alt="image" src="https://github.com/user-attachments/assets/d60ae06c-2f8d-44e1-91c3-71d62a26e452" />
<img width="1126" height="794" alt="image" src="https://github.com/user-attachments/assets/68dcf87c-8e72-4318-b129-0830c3e4de43" />
<img width="1128" height="796" alt="image" src="https://github.com/user-attachments/assets/0a476eb2-f82f-47b0-8ef7-e24aea43f46d" />


</details>
<details> 
<summary> 1430 ~ 1457 </summary>
<img width="1123" height="794" alt="image" src="https://github.com/user-attachments/assets/b042362d-ff4e-4301-b40a-67bf8e86f3b1" />

<img width="1129" height="804" alt="image" src="https://github.com/user-attachments/assets/14ae0080-36f8-4a57-b8c6-453d98ab0a1b" />
<img width="1127" height="787" alt="image" src="https://github.com/user-attachments/assets/9080e6f3-13d7-4ad1-b063-2c13cf501f5f" />
<img width="1123" height="793" alt="image" src="https://github.com/user-attachments/assets/d99182a5-c56e-46aa-af98-3cc552d1b676" />

</details>
<details> 
<summary> 1457 ~ 1500 </summary>
<img width="1126" height="794" alt="image" src="https://github.com/user-attachments/assets/d28ee89e-c0ee-41a4-b2af-acf74ae3e45e" />
<img width="1134" height="799" alt="image" src="https://github.com/user-attachments/assets/9defe677-3491-4147-81e9-870fa97d61ed" />
<img width="1125" height="792" alt="image" src="https://github.com/user-attachments/assets/bdc68659-9887-4f24-aca3-541788a94934" />
<img width="1127" height="790" alt="image" src="https://github.com/user-attachments/assets/eea28ab4-51f0-4a60-986b-5716cc418701" />

</details>
<details> 
<summary> 0930 ~ 1457 </summary>
<img width="1130" height="799" alt="image" src="https://github.com/user-attachments/assets/0a637dbc-2620-49f9-a37e-31b5282c56be" />
<img width="1125" height="799" alt="image" src="https://github.com/user-attachments/assets/b57549e3-0dc2-452b-be8f-e54c31511303" />
<img width="1126" height="797" alt="image" src="https://github.com/user-attachments/assets/260ec118-caa3-4bac-b5ca-10a7cbe776d9" />

</details>


#### 三种缩尾方式分时段结果比较测试

[P01P99_Price_Divergence_Results.pdf](https://github.com/user-attachments/files/21588506/P01P99_Price_Divergence_Results.pdf)
[P03P97_Price_Divergence_Comparison.pdf](https://github.com/user-attachments/files/21588508/P03P97_Price_Divergence_Comparison.pdf)
[P05P95_Price_Divergence_Comparison.pdf](https://github.com/user-attachments/files/21588512/P05P95_Price_Divergence_Comparison.pdf)




### 分钟频价格分歧度
##### 1. 买方
<img width="1123" height="793" alt="image" src="https://github.com/user-attachments/assets/99c9bb2a-2832-418f-a9b2-311418730027" />

- winsorize后结果
<img width="1127" height="797" alt="image" src="https://github.com/user-attachments/assets/0ebbe1a4-6654-430b-9d1b-ba1c66b0a3ab" />


##### 2. 卖方
<img width="1125" height="793" alt="image" src="https://github.com/user-attachments/assets/0361f4be-765d-494f-a926-5fd7cbb28367" />

- winsorize后结果
<img width="1125" height="798" alt="image" src="https://github.com/user-attachments/assets/74bfad70-0b04-46ab-95ed-76e25db5f4af" />

<img width="677" height="680" alt="image" src="https://github.com/user-attachments/assets/adf8ef83-3a67-41af-be31-52d73eaf4d52" />


##### 买卖双方分歧度与分钟频收益率的关系
<img width="1735" height="1336" alt="image" src="https://github.com/user-attachments/assets/cbe56b23-1076-4c30-ae71-18f3aac1071a" />




### 与分钟收益率的暴露度
构造方式：

- 每天，对于每一支股票，按照分钟收益率排序，挑选这一值TAIL或TOP20%的分钟，计算这些分钟的[P01,P99]缩尾后价格买卖双方方平均分钟分歧度
- 每天，对于每一支股票，对于每一支股票，按照买卖双方方[P01,P99]缩尾后价格平均分钟分歧度排序，挑选这一值TAIL或TOP20%的分钟，计算这些分钟的平均分钟收益率

#### 按照收益率情况挑选分钟

- 低分钟收益率组平均分歧度
<img width="1126" height="791" alt="image" src="https://github.com/user-attachments/assets/04217468-ef3c-42ad-8841-9c5d94358c30" />

<img width="1121" height="795" alt="image" src="https://github.com/user-attachments/assets/0de7dcaf-5da8-4c13-8608-12f2e2c80705" />


- 高分钟收益率组平均分歧度
<img width="1125" height="799" alt="image" src="https://github.com/user-attachments/assets/06851b3e-d64f-44cf-9bb4-1685231fa041" />

<img width="1122" height="794" alt="image" src="https://github.com/user-attachments/assets/dd01884e-64ea-4641-88a6-eb0bd94fe3f5" />


- 结论：买卖双方方向一致，说明收益率对分歧度没有显著区分效果

#### 按照分歧度情况挑选分钟

- 买卖方分钟分歧度整体相关性: 0.1436857749411973
- 低价格分歧度组平均收益率
<img width="1126" height="795" alt="image" src="https://github.com/user-attachments/assets/0fcdb11d-ee96-4792-ae4c-df21762ee33b" />
<img width="1125" height="796" alt="image" src="https://github.com/user-attachments/assets/7fd64505-2fdd-4877-b4a8-33564a120057" />


- 高价格分歧度组平均收益率
<img width="1127" height="798" alt="image" src="https://github.com/user-attachments/assets/7b441e4d-22dc-49e9-b4b5-9c5ebfa5306c" />
<img width="1126" height="794" alt="image" src="https://github.com/user-attachments/assets/da700e44-6b54-423a-b5ca-8ce7f6330e78" />


- 结论：买卖双方方向相反，说明分歧度对收益率有显著区分效果

### 与分钟收益率相关性分析
#### 买方     
- 整体相关性: -0.014331000772016924     
<img width="371" height="377" alt="image" src="https://github.com/user-attachments/assets/0727a27b-d8e7-427b-94b4-7b0c7b0a85d1" />
<img width="1124" height="799" alt="image" src="https://github.com/user-attachments/assets/ea7e1f2c-f386-4e27-90ad-18d4227ed7e7" />
<img width="1123" height="793" alt="image" src="https://github.com/user-attachments/assets/2b3e4059-6364-42a4-990b-73e165576b01" />


#### 卖方     
- 整体相关性: 0.04731180885271494     
<img width="376" height="375" alt="image" src="https://github.com/user-attachments/assets/36b38b8d-7d59-4417-853f-97183494c8c1" />
<img width="1125" height="800" alt="image" src="https://github.com/user-attachments/assets/fb9ac7ac-a249-4394-b3a9-420572b6d163" />
<img width="1122" height="794" alt="image" src="https://github.com/user-attachments/assets/c4ae07d6-ac79-45b4-8fb8-861b61970f7f" />


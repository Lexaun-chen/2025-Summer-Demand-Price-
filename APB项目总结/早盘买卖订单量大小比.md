### 因子：早盘买卖订单量大小比
#### 定义：
```math
\text{早盘买卖单大小比} = ln（\frac{\text{10: 30 前的买入订单平均委托量}}{\text{10: 30 前的卖出订单平均委托量}} ）
```

<details>
<summary>研报重点信息摘录</summary>    

1. 早盘区间： [93000000,103000000)     

2. 因子构建目的：
 
          刻画早盘时间段新增的订单情况 -> 获取不同投资者的买卖方向 -> 跟踪资金走向:当大资金买入时跟进，大资金卖出时退出

3. 研报结果：早盘买入订单更大的股票平均表现更好、卖出订单更大的股票表现更差
</details>

##### 初步复现结果
- 发现：short_rev的负相关性较高；空头反转效应极强
![image](/uploads/a7ce96ec037beb24466c96c0e773d59f/image.png)

<details>
<summary>直接中性化short_rev</summary> 
   
- 结果：对分组收益率影响较大，降低低位组的收益率，增加了高位组的收益率；反转效应依旧存在，高位各组收益基本呈单调性。    
- 猜测：因子与short_rev 负相关 -> 低位组为short_rev中的高位组，收益受益于short_rev，高位组为short_rev中的低位组，收益受short_rev反映的反转效应影响较大。

![image](/uploads/24869f984c3b535ce71d64485492a301/image.png)
</details>


### 初步改进
- 改进一：将每日的因子值和同时间段的收益率回归取残差

<details>
<summary>解释与结果</summary> 
   
- 改进逻辑：short_rev会较大程度影响分组收益，且对多空方影响方向不同，说明因子容易受短期收益率影响。A股市场反转效应较强，尝试直接同时间段的收益率回归取残差，剥离收益率影响。
- 结果：对分组收益率影响较大：降低低位组的收益率，增加了高位组的收益率；
![image](/uploads/3519a6abdfabfc4cc281159352d85fab/image.png)
</details>

- 改进二：当日同时段发生过盘中涨跌停的个股因子值置为nan
<details>
<summary>解释与结果</summary> 
   
- 改进逻辑：涨跌停会大幅度影响买卖订单量的数量和分布，从而影响因子值。
- 结果：分组收益与原始结果基本保持一致，说明涨跌停股票影响较小。
![image](/uploads/3cf727d4dd72b3f797e4aa6b05987bf6/image.png)
</details>

#### 验证因子与同时段收益率的相关性与暴露度

**结论：按因子值分组后，各组的表现差异更像是随机波动，而非因子本身的预测能力。**

<details>
<summary>与同时段收益率：用未滚动过的每日因子</summary>

a. 相关性
![image](/uploads/f9f1979d6120ffa8e249cca2fc7abeda/image.png)

b. 各组内暴露度
![image](/uploads/524d2aa5ef522e89c03e0fbd22761c8a/image.png)
![image](/uploads/9cdd54be28c2dc6cc9895edd405090fd/image.png)
</details>


<details>
<summary>与平滑过的short_reversal：用20d滚动过的每日因子</summary>

a. 相关性
![image](/uploads/b49e8f902d888e357e20bbf7738e6d3e/image.png)
与short_reversal相关性也并不高。

b. 各组内暴露度
![image](/uploads/49fa741f259e9cb2280bc8f2fdc2d7d8/image.png)
![image](/uploads/98561b1e64a1ad9a460e915c1d0fa027/image.png)
</details>



### 进一步改进：构造方式     
#### 1. 从平均委托量改成总平均委托量     
<details>
<summary>结果</summary>
![image](/uploads/a53c2abf984a45c471a87be116c35492/image.png)
</details>



#### 2. 构造**净委托量**概念    

有如下两种构造方式：
```math
\text{早盘净委托量} = \text{Sign} *  ln（1 + \frac{\text{|10: 30 前的买入订单总委托量 - 10: 30 前的卖出订单总委托量|}}{\text{10: 30 前的买入订单总委托量 + 10: 30 前的卖出订单总委托量}} ） 
```
测试时间：2021-01-01 ~ 2025-12-31      
![image](/uploads/df21877ea056f1cda51671d2daacddcd/image.png)

```math
\text{早盘净委托量} = \frac{\text{10: 30 前的买入订单总委托量 - 10: 30 前的卖出订单总委托量}}{\text{10: 30 前的买入订单总委托量 + 10: 30 前的卖出订单总委托量}}  
```
测试时间：2021-01-01 ~ 2025-12-31      
![image](/uploads/472cda6b743fbd98bf11a2be77307eb2/image.png)

- 分时段进行全时间段测试：     
测试时间：2019-01-02 ~ 2025-5-31      
<details>
<summary> 9：30~10：30 </summary>
![image](/uploads/15c9e9305921f12f860de4028e6cb01b/image.png)
</details>
<details>
<summary> 9：30~10：00 </summary>
![image](/uploads/0dd08c9718071e7077f3378339a67c4b/image.png)
</details>
<details>
<summary> 10：00~10：30 </summary>
![image](/uploads/249a6af614a85ac7472af7fa28583283/image.png)
</details>

#### 3.按百分比筛选大单    
以所有委托单量的90分位数作为threshold筛选大单子，对筛选出来的大单进一步区分买卖方向    


<details>
<summary> a. 早盘大单买卖订单大小比因子 </summary>
- SUM()
![image](/uploads/003af06b551f9df8850fb4ce53dde3d2/image.png)
- AVG()
![image](/uploads/17c9608d4163c50a9f98ab692311dc28/image.png)
</details>


<details>
<summary> b. 净委托量 </summary>
![image](/uploads/1c7b6a94b8cddbc36be4b988bf46d06d/image.png)
![image](/uploads/6084b3fa0dfa949446d14b9546dc57a6/image.png)
</details>
